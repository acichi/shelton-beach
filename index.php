<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Shelton Beach Resort</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="author" content="" />
    
    <!-- Prevent caching to ensure fresh styles -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Load Bootstrap and other frameworks first -->
    <link rel="stylesheet" href="css/bootstrap.min.css?v=<?php echo filemtime('css/bootstrap.min.css'); ?>">
    <link rel="stylesheet" href="css/animate.css?v=<?php echo filemtime('css/animate.css'); ?>">
    <link rel="stylesheet" href="css/owl.carousel.min.css?v=<?php echo filemtime('css/owl.carousel.min.css'); ?>">
    <link rel="stylesheet" href="css/aos.css?v=<?php echo filemtime('css/aos.css'); ?>">
    <link rel="stylesheet" href="css/bootstrap-datepicker.css?v=<?php echo filemtime('css/bootstrap-datepicker.css'); ?>">
    <link rel="stylesheet" href="css/jquery.timepicker.css?v=<?php echo filemtime('css/jquery.timepicker.css'); ?>">
    <link rel="stylesheet" href="css/fancybox.min.css?v=<?php echo filemtime('css/fancybox.min.css'); ?>">
    
    <!-- Load custom fonts -->
    <link rel="stylesheet" href="fonts/ionicons/css/ionicons.min.css?v=<?php echo filemtime('fonts/ionicons/css/ionicons.min.css'); ?>">
    <link rel="stylesheet" href="fonts/fontawesome/css/font-awesome.min.css?v=<?php echo filemtime('fonts/fontawesome/css/font-awesome.min.css'); ?>">
    
    <!-- Navbar styles (needed for navbar markup) -->
    <link rel="stylesheet" href="css/navbar-enhanced.css?v=<?php echo filemtime('css/navbar-enhanced.css'); ?>">
    <link rel="stylesheet" href="css/navbar-simple.css?v=<?php echo filemtime('css/navbar-simple.css'); ?>">
    <link rel="stylesheet" href="css/theme-overrides.css?v=<?php echo filemtime('css/theme-overrides.css'); ?>">
    
    <!-- Load your custom CSS LAST to override Bootstrap -->
    <link rel="stylesheet" href="css/style.css?v=<?php echo filemtime('css/style.css'); ?>">
  </head>

  <body>

<?php include 'navbar.php'; ?>

    <section id="top" class="site-hero overlay" style="background-image: url(pics/bg.png)" data-stellar-background-ratio="0.5">
      <div class="container">
        <div class="row site-hero-inner justify-content-center align-items-center">
          <div class="col-md-10 text-center" data-aos="fade-up">
            <img src="pics/logo2.png" alt="Shelton Beach Resort Logo" class="img-fluid mb-4 logo-hero">
            <span class="custom-caption text-uppercase text-white d-block  mb-3">Navigate your stay with precision</span>
            <h1 class="heading" style="color: white !important;">Shelton Beach Resort</h1>
          </div>
        </div>
      </div>
    </section>
    <!-- END section -->

    <section class="py-5 bg-light">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-12 col-lg-7 ml-auto order-lg-2 position-relative mb-5" data-aos="fade-up">
            <figure class="img-absolute">
              <img src="pics/logo2.png" alt="Image" class="img-fluid">
            </figure>
            <img src="pics/1.svg" alt="Image" class="img-fluid rounded">
          </div>
          <div class="col-md-12 col-lg-4 order-lg-1" data-aos="fade-up">
            <h2 class="heading" style="color: #7ab4a1 !important;">Welcome!</h2>
            <p class="mb-4">Tucked along the shores of Negros Occidental, Shelton Beach Resort is more than a destination — it's a place where families come together, friends reconnect, and the ocean becomes part of every memory.</p>
            <p><a href="#" class="btn btn-primary text-white py-2 mr-3" data-bs-toggle="modal" data-bs-target="#resortMapModal">View Map</a> <span class="mr-3 font-family-serif"><em>or</em></span> <a href="#" onclick="openLoginModal(); return false;" class="text-uppercase letter-spacing-1">Sign In</a></p>
          </div>
                  </div>
      </div>
    </section>
          
    <!-- About Section -->
    <section class="section bg-light" id="about-section">
      <div class="container">
        <div class="row align-items-center mb-5">
          <div class="col-lg-6 mb-4" data-aos="fade-up">
            <img src="pics/logo2.png" alt="Shelton Beach Resort" class="img-fluid rounded">
          </div>
          <div class="col-lg-6" data-aos="fade-up">
            <h2 class="heading mb-4" style="color: #7ab4a1 !important;">About Us</h2>
            <p>Escape to the breathtaking beauty of JW25+RRJ, Bacolod, Negros Occidental. Shelton Beach Resort offers an unforgettable blend of luxury, tranquility, and adventure.</p>
            <h4 class="mt-4" style="color: #7ab4a1 !important;">Our Story</h4>
            <p>Founded in 2002 by Clifford Orland C. Palma, Shelton Beach Resort began as a small family dream and evolved into a premier beachfront haven of peace, elegance, and sustainability.</p>
          </div>
        </div>
      </div>
    </section>
    
        <!-- Meet Our Founder Section -->
    <section class="section bg-light" data-aos="fade-up">
      <div class="container">
        <div class="row text-center mb-5">
          <div class="col-md-12">
            <h2 class="heading" style="color: #7ab4a1 !important;">Meet Our Founder & Our Vision</h2>
            <p>Discover the heart, mission, and vision behind Shelton Beach Resort.</p>
          </div>
        </div>
        
        <div class="row align-items-center">
          <div class="col-lg-5 mb-4" data-aos="fade-up">
            <div class="text-center">
              <img src="pics/cliff.png" class="img-fluid rounded-circle mb-4" style="max-width: 200px;" alt="Clifford Orland C. Palma">
              <h4 class="mb-1">Clifford Orland C. Palma</h4>
              <p class="text-muted">Founder & Visionary</p>
            </div>
          </div>
          
          <div class="col-lg-7" data-aos="fade-up">
              <blockquote class="blockquote">
                <p class="mb-0">"Shelton Beach was built on faith, family, and a dream to share paradise with others."</p>
              </blockquote>
              
              <div class="row mt-4">
                <div class="col-md-6">
                  <h4 class="text-primary mb-3">Our Mission</h4>
                  <p>To provide the ultimate island escape through warm hospitality, exceptional comfort, and a deep commitment to environmental care and community upliftment.</p>
                </div>
                <div class="col-md-6">
                  <h4 class="text-primary mb-3">Our Vision</h4>
                  <p>To be the premier beach resort in Negros Occidental — known for sustainable tourism, heartfelt service, and unforgettable tropical experiences for every guest.</p>
                </div>
              </div>
              
              <div class="text-center mt-4">
                <p class="font-italic mb-0">"The Lord will fight for you; you need only to be still." – <strong>Exodus 14:14</strong></p>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row mt-5">
          <div class="col-12" data-aos="fade-up">
            <img src="pics/5.png" alt="Shelton Beach Resort" class="img-fluid rounded shadow" style="width: 100%; max-height: 400px; object-fit: cover;">
          </div>
        </div>
      </div>
    </section>


    
    <!-- What We Offer Section -->
<section id="offer" class="section bg-white">
  <div class="container">
    <div class="row text-center mb-5">
      <div class="col-md-12" data-aos="fade-up">
        <h2 class="heading" style="color: #7ab4a1 !important;">What We Offer </h2>
        <p>Discover what makes us special.</p>
      </div>
    </div>
    <div class="row text-center">
      <div class="col-md-3" data-aos="fade-up" data-aos-delay="100">
        <div class="p-4">
          <span class="icon ion-ios-sunny-outline display-4 text-primary"></span>
          <h4 class="mt-3">Scenic Views</h4>
          <p>From sunrise to sunset, every angle of Shelton Beach offers a perfect backdrop for your vacation memories.</p>
        </div>
      </div>
      <div class="col-md-3" data-aos="fade-up" data-aos-delay="200">
        <div class="p-4">
          <span class="icon ion-ios-home-outline display-4 text-primary"></span>
          <h4 class="mt-3">Cozy Cottages</h4>
          <p>Our native-style cottages give you comfort, privacy, and a close-to-nature experience.</p>
        </div>
      </div>
      <div class="col-md-3" data-aos="fade-up" data-aos-delay="300">
        <div class="p-4">
          <span class="icon ion-ios-people-outline display-4 text-primary"></span>
          <h4 class="mt-3">Family-Friendly</h4>
          <p>Whether it's a weekend getaway or a birthday bash, we welcome families and big groups with open arms.</p>
        </div>
      </div>
      <div class="col-md-3" data-aos="fade-up" data-aos-delay="400">
        <div class="p-4">
          <span class="icon ion-ios-cart-outline display-4 text-primary"></span>
          <h4 class="mt-3">Amenities</h4>
          <p>The resort has a swimming pool, various cottages to choose from, and a store where guests can buy food, drinks, and necessities.</p>
        </div>
      </div>
    </div>
  </div>
</section>

    <!-- Gallery Section -->
    <section id="gall" class="section bg-light" id="gallery-section">
      <div class="container">
        <div class="row justify-content-center text-center mb-5">
          <div class="col-md-7">
            <h2 class="heading" data-aos="fade-up" style="color: #7ab4a1 !important;">Resort Gallery</h2>
            <p data-aos="fade-up">Explore the beauty of Shelton Beach Resort through our latest photos</p>
          </div>
        </div>
        
        <div class="row">
          <?php
          // Gallery display from database so admin edits/deletes reflect on homepage
          if (!isset($conn)) { require 'properties/connection.php'; }
          $galleryImages = [];
          $res = $conn->query("SELECT gallery_id AS id, COALESCE(gallery_description,'') AS description, COALESCE(gallery_image,'') AS location, COALESCE(gallery_date_added,'') AS date_added FROM gallery_tbl ORDER BY gallery_date_added DESC, gallery_id DESC LIMIT 9");
          if ($res) {
            while ($row = $res->fetch_assoc()) {
              $loc = trim($row['location'] ?? '');
              if ($loc !== '') {
                if (preg_match('~^(https?:)?//~', $loc) || strpos($loc, '/') === 0) {
                  // absolute URL or root-relative; keep as-is
                } else if (strpos($loc, '/') === false) {
                  // bare filename -> assume uploads/gallery
                  $loc = 'uploads/gallery/' . $loc;
                }
              }
              $title = trim($row['description'] ?? '');
              if ($title === '') {
                $base = basename($loc);
                $title = ucwords(str_replace(['_', '-', '.jpg', '.jpeg', '.png', '.gif', '.webp'], [' ', ' ', '', '', '', '', ''], strtolower($base)));
              }
              $galleryImages[] = [ 'path' => $loc, 'title' => $title ];
            }
          }
          ?>

          <?php if (!empty($galleryImages)): ?>
            <?php foreach ($galleryImages as $index => $image): ?>
              <div class="col-md-4 col-sm-6 mb-4" data-aos="fade-up" data-aos-delay="<?php echo $index * 100; ?>">
                <a href="<?php echo $image['path']; ?>" class="fancybox" data-fancybox="gallery" data-caption="<?php echo htmlspecialchars($image['title']); ?>">
                  <div class="gallery-item">
                    <img src="<?php echo $image['path']; ?>" alt="<?php echo htmlspecialchars($image['title']); ?>" class="img-fluid rounded">
                    <div class="gallery-overlay">
                      <div class="gallery-text">
                        <h4><?php echo htmlspecialchars($image['title']); ?></h4>
                        <span>View Full Size</span>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
            <?php endforeach; ?>
          <?php else: ?>
            <div class="col-12 text-center">
              <p class="text-muted">No images in gallery yet. Upload some photos to see them here!</p>
            </div>
          <?php endif; ?>
        </div>
      </div>
    </section>

    <style>
    #gallery-section {
      padding: 80px 0;
    }
    
    .gallery-item {
      position: relative;
      overflow: hidden;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }
    
    .gallery-item:hover {
      transform: translateY(-5px);
    }
    
    .gallery-item img {
      width: 100%;
      height: 250px;
      object-fit: cover;
    }
    
    .gallery-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .gallery-item:hover .gallery-overlay {
      opacity: 1;
    }
    
    .gallery-text {
      text-align: center;
      color: white;
    }
    
    .gallery-text h4 {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }
    
    .gallery-text span {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    </style>

    
    <!-- FEEDBACKS SECTION -->
    <section id="feed" class="section bg-light">
      <div class="container">
        <div class="row mb-5 text-center">
          <div class="col-md-8 mx-auto">
            <h2 class="heading mb-4" data-aos="fade-up" style="color: #7ab4a1 !important;">Guest Feedback</h2>
            <p data-aos="fade-up" data-aos-delay="100">
              Here are some of the kind words and honest reviews from our wonderful guests.
            </p>
          </div>
        </div>

        <?php
          // Database connection
          require 'properties/connection.php';

          if ($conn->connect_error) {
            echo "<div class='col-12 text-center text-danger'><p>Database connection failed: " . $conn->connect_error . "</p></div>";
          } else {
            // Fetch average rating & total reviews (only visible feedback)
            $avgSql = "SELECT AVG(COALESCE(feedback_rate,0)) AS avg_rating, COUNT(*) AS total_reviews 
                       FROM feedback_tbl 
                       WHERE feedback_status <> 'hide'";
            $avgResult = $conn->query($avgSql);
            $avgData = $avgResult->fetch_assoc();
            $averageRating = round($avgData['avg_rating'], 1);
            $totalReviews = $avgData['total_reviews'];

            if ($totalReviews > 0) {
              echo "<div class='rating-summary' data-aos='fade-up'>
                      <div class='stars'>";
                        $filledStars = floor($averageRating);
                        $emptyStars = 5 - $filledStars;
                        for ($i = 0; $i < $filledStars; $i++) echo "<i class='fa fa-star'></i>";
                        if ($averageRating - $filledStars >= 0.5) {
                          echo "<i class='fa fa-star-half-o'></i>";
                          $emptyStars--;
                        }
                        for ($i = 0; $i < $emptyStars; $i++) echo "<i class='fa fa-star-o'></i>";
              echo    "</div>
                      <h3>$averageRating / 5 based on $totalReviews reviews</h3>
                    </div>";
            }
        ?>

        <!-- Star Rating Filter -->
        <div class="rating-filter-container" data-aos="fade-up" data-aos-delay="200">
          <div class="rating-filter">
            <button class="filter-btn active" data-rating="all">
              <span>All Reviews</span>
              <small class="filter-count"><?php echo $totalReviews; ?></small>
            </button>
            <?php
              // Count reviews for each star rating
              for ($star = 5; $star >= 1; $star--) {
                $countSql = "SELECT COUNT(*) as count FROM feedback_tbl WHERE COALESCE(feedback_rate,0) = $star AND feedback_status <> 'hide'";
                $countResult = $conn->query($countSql);
                $countData = $countResult->fetch_assoc();
                $count = $countData['count'];
                
                if ($count > 0) {
                  echo "<button class='filter-btn' data-rating='$star'>
                          <span>$star Star" . ($star > 1 ? 's' : '') . "</span>
                          <small class='filter-count'>$count</small>
                        </button>";
                }
              }
            ?>
          </div>
        </div>

        <div class="row" id="feedback-container">
          <?php
              // Fetch feedbacks with 9-entry limit
              $sql = "SELECT COALESCE(feedback_name,'') AS fullname, COALESCE(feedback_facility,'') AS facility_name, COALESCE(feedback_message,'') AS feedback, COALESCE(feedback_rate,0) AS rate, COALESCE(feedback_timestamp,'') AS timestamp 
                      FROM feedback_tbl 
                      WHERE feedback_status <> 'hide'
                      ORDER BY feedback_timestamp DESC
                      LIMIT 9";
              $result = $conn->query($sql);

              if (!$result) {
                echo "<div class='col-12 text-center text-danger'><p>SQL error: " . $conn->error . "</p></div>";
              } else if ($result->num_rows > 0) {
                while ($row = $result->fetch_assoc()) {
                  $fullname = htmlspecialchars($row['fullname']);
                  $facility = htmlspecialchars($row['facility_name']);
                  $feedback = nl2br(htmlspecialchars($row['feedback']));
                  $rate = intval($row['rate']);
                  $timestamp = date("F j, Y", strtotime($row['timestamp']));

                  echo '<div class="col-md-6 col-lg-4" data-aos="fade-up" data-rating="'.$rate.'">';
                    echo '<div class="feedback-card" data-rate="'.$rate.'">';
                      echo "<div class='feedback-name'>$fullname</div>";
                      echo "<div class='feedback-stars'>";
                        for ($i = 0; $i < $rate; $i++) echo "<i class='fa fa-star'></i>";
                        for ($i = $rate; $i < 5; $i++) echo "<i class='fa fa-star-o'></i>";
                      echo "</div>";
                      echo "<div class='feedback-text'>\"$feedback\"</div>";
                      echo "<div class='feedback-meta'>Facility: $facility <br> Date: $timestamp</div>";
                    echo '</div>';
                  echo '</div>';
                }
              } else {
                echo '<div class="col-12 text-center"><p>No feedback available yet. Be the first to share your experience!</p></div>';
              }

              $conn->close();
            }
          ?>
        </div>
      </div>
    </section>

    <style>
      .feedback-card {
        background: #fff;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        margin-bottom: 30px;
        min-height: 220px;
        transition: all 0.3s ease;
        border: 1px solid rgba(255,255,255,0.2);
      }
      
      .feedback-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.15);
      }
      
      .feedback-name {
        font-weight: bold;
        font-size: 1.2rem;
        color: #e08f5f;
        margin-bottom: 8px;
      }
      
      .feedback-stars {
        color: #ffc107;
        margin: 8px 0;
        font-size: 1.1rem;
      }
      
      .feedback-text {
        margin-top: 15px;
        color: #444;
        font-style: italic;
        line-height: 1.6;
        margin-bottom: 15px;
      }
      
      .feedback-meta {
        font-size: 0.9rem;
        color: #666;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #eee;
      }
      
      .rating-summary {
        background: linear-gradient(135deg, #7ab4a1, #e08f5f);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 40px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        text-align: center;
        color: white;
      }
      
      .rating-summary .stars {
        color: #ffd700;
        font-size: 2rem;
        margin-bottom: 15px;
      }
      
      .rating-summary h3 {
        margin: 0;
        font-size: 1.5rem;
        color: white;
        font-weight: 600;
      }
      
      /* Star Rating Filter Styles */
      .rating-filter-container {
        margin-bottom: 40px;
        text-align: center;
      }
      
      .rating-filter {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
        max-width: 800px;
        margin: 0 auto;
      }
      
      .filter-btn {
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid transparent;
        border-radius: 25px;
        padding: 12px 20px;
        font-size: 0.95rem;
        font-weight: 500;
        color: #444;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        min-width: 100px;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
      }
      
      .filter-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s ease;
      }
      
      .filter-btn:hover::before {
        left: 100%;
      }
      
      .filter-btn:hover {
        background: rgba(255, 255, 255, 1);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        border-color: #e08f5f;
      }
      
      .filter-btn.active {
        background: linear-gradient(135deg, #e08f5f, #e19985);
        color: white;
        border-color: #e08f5f;
        box-shadow: 0 8px 20px rgba(224, 143, 95, 0.3);
        transform: translateY(-2px);
      }
      
      .filter-btn.active::after {
        content: '✓';
        position: absolute;
        top: 8px;
        right: 12px;
        font-size: 0.8rem;
        font-weight: bold;
        color: white;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        width: 18px;
        height: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .filter-btn span {
        font-weight: 600;
      }
      
      .filter-count {
        font-size: 0.8rem;
        opacity: 0.8;
        font-weight: 400;
      }
      
      .filter-btn.active .filter-count {
        opacity: 1;
      }
      
      /* Responsive Design */
      @media (max-width: 768px) {
        .rating-filter {
          gap: 10px;
        }
        
        .filter-btn {
          padding: 10px 15px;
          font-size: 0.9rem;
          min-width: 80px;
        }
        
        .rating-summary {
          padding: 20px;
        }
        
        .rating-summary .stars {
          font-size: 1.5rem;
        }
        
        .rating-summary h3 {
          font-size: 1.3rem;
        }
      }
      
      @media (max-width: 576px) {
        .rating-filter {
          flex-direction: column;
          align-items: center;
        }
        
        .filter-btn {
          width: 200px;
        }
      }
      
      /* Reservation Section Styles */
      .reservation-card {
        background: #fff;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        border: 1px solid rgba(122, 180, 161, 0.2);
        transition: all 0.3s ease;
      }
      
      .reservation-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 50px rgba(0,0,0,0.15);
      }
      
      .reservation-icon {
        margin-bottom: 20px;
      }
      
      .reservation-actions {
        margin-bottom: 20px;
      }
      
      .login-required .alert {
        border-radius: 15px;
        border: none;
        background: linear-gradient(135deg, rgba(122, 180, 161, 0.1), rgba(224, 143, 95, 0.1));
        color: #495057;
      }
      
      .reservation-options {
        margin-bottom: 20px;
      }
      
      .reservation-card h5 {
        color: #7ab4a1;
        margin-bottom: 20px;
      }
      
      .reservation-card ul li {
        margin-bottom: 10px;
        font-size: 0.95rem;
      }
      
      .reservation-card .btn {
        border-radius: 25px;
        padding: 12px 25px;
        font-weight: 500;
        transition: all 0.3s ease;
      }
      
      .reservation-card .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      }
      
      @media (max-width: 768px) {
        .reservation-card {
          padding: 30px 20px;
        }
        
        .reservation-actions .btn {
          width: 100%;
          margin-bottom: 10px;
        }
      }
    </style>

    <!-- RESERVATION SECTION - Login Required -->
    <section id="reservation-section" class="section bg-light">
      <div class="container">
        <div class="row text-center mb-5">
          <div class="col-md-12" data-aos="fade-up">
            <h2 class="heading" style="color: #7ab4a1 !important;">Ready to Reserve?</h2>
            <p class="lead">Experience the perfect beach getaway at Shelton Beach Resort</p>
          </div>
        </div>
        
        <div class="row justify-content-center">
          <div class="col-md-8 col-lg-6" data-aos="fade-up" data-aos-delay="200">
            <div class="reservation-card text-center">
              <div class="reservation-icon mb-4">
                <i class="fa fa-calendar-check-o fa-3x" style="color: #7ab4a1;"></i>
              </div>
              
              <h3 class="mb-3">Book Your Perfect Stay</h3>
              <p class="mb-4">Choose from our selection of cozy cottages and facilities. All reservations require a user account for security and convenience.</p>
              
              <?php if ($isLoggedIn): ?>
                <!-- User is logged in - show reservation options -->
                <div class="reservation-options">
                  <a href="customerdash/book_now.php" class="btn btn-primary btn-lg me-3 mb-2">
                    <i class="fa fa-calendar-plus-o me-2"></i>Make Reservation
                  </a>
                  <a href="customerdash/cusdash.php" class="btn btn-outline-primary btn-lg mb-2">
                    <i class="fa fa-tachometer me-2"></i>View Dashboard
                  </a>
                </div>
                <div class="mt-3">
                  <small class="text-muted">Welcome back, <?php echo htmlspecialchars($userName); ?>! You're all set to make reservations.</small>
                </div>
              <?php else: ?>
                <!-- User is not logged in - show login requirement -->
                <div class="login-required">
                  <div class="alert alert-info mb-4">
                    <i class="fa fa-info-circle me-2"></i>
                    <strong>Login Required:</strong> Please create an account or sign in to make reservations.
                  </div>
                  
                  <div class="reservation-actions">
                    <button class="btn btn-primary btn-lg me-3 mb-2" onclick="openLoginModal()">
                      <i class="fa fa-sign-in me-2"></i>Login
                    </button>
                    <button class="btn btn-success btn-lg mb-2" onclick="openRegisterModal()">
                      <i class="fa fa-user-plus me-2"></i>Create Account
                    </button>
                  </div>
                  
                  <div class="mt-4">
                    <h5>Why Create an Account?</h5>
                    <div class="row text-start">
                      <div class="col-md-6">
                        <ul class="list-unstyled">
                          <li><i class="fa fa-check text-success me-2"></i>Secure reservations</li>
                          <li><i class="fa fa-check text-success me-2"></i>Track booking history</li>
                          <li><i class="fa fa-check text-success me-2"></i>Easy payment processing</li>
                        </ul>
                      </div>
                      <div class="col-md-6">
                        <ul class="list-unstyled">
                          <li><i class="fa fa-check text-success me-2"></i>Manage your stays</li>
                          <li><i class="fa fa-check text-success me-2"></i>Receive updates</li>
                          <li><i class="fa fa-check text-success me-2"></i>Special member benefits</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              <?php endif; ?>
            </div>
          </div>
        </div>
      </div>
    </section>

    
  <!-- Inquiries -->
<section class="section bg-white" id="us">
  <div class="container">
    <div class="row text-center mb-5">
      <div class="col-md-12" data-aos="fade-up">
        <h2 class="heading">Contact Us</h2>
        <p class="text-muted">Visit Shelton Beach Haven at Punta Taytay, Bacolod City</p>
        <hr class="w-25 mx-auto" style="border-top: 3px solid #7ab4a1; opacity: 0.5;">
      </div>
    </div>
    
    <div class="row" data-aos="fade-up" data-aos-delay="200">
      <!-- Inquiry Form Column (Full Width) -->
      <div class="col-lg-12 mb-4" data-aos="fade-up" data-aos-delay="200">
        <div class="inquiry-form-container shadow rounded" style="border: 4px solid #7ab4a1; border-radius: 20px; background: #fff; padding: 2rem;">
          <div class="text-center mb-4">
            <div class="inquiry-icon mb-3">
              <i class="fa fa-envelope fa-3x" style="color: #7ab4a1;"></i>
            </div>
            <h3 class="inquiry-title" style="color: #2c3e50; font-size: 1.8rem; font-weight: 600;">Send an Inquiry</h3>
            <p class="inquiry-subtitle" style="color: #6c757d; font-size: 1.1rem;">Have questions? We'd love to hear from you!</p>
          </div>
          
          <form id="inquiryForm" class="inquiry-form">
            <div class="form-group mb-3">
              <label for="inquiryName" class="form-label" style="color: #2c3e50; font-weight: 600; margin-bottom: 0.5rem;">
                <i class="fa fa-user me-2" style="color: #7ab4a1;"></i>Full Name
              </label>
              <input type="text" class="form-control inquiry-input" id="inquiryName" name="name" placeholder="Enter your full name" required>
            </div>
            
            <div class="form-group mb-3">
              <label for="inquiryEmail" class="form-label" style="color: #2c3e50; font-weight: 600; margin-bottom: 0.5rem;">
                <i class="fa fa-envelope me-2" style="color: #7ab4a1;"></i>Email Address
              </label>
              <input type="email" class="form-control inquiry-input" id="inquiryEmail" name="email" placeholder="Enter your email address" required>
            </div>
            
            <div class="form-group mb-4">
              <label for="inquiryMessage" class="form-label" style="color: #2c3e50; font-weight: 600; margin-bottom: 0.5rem;">
                <i class="fa fa-comment me-2" style="color: #7ab4a1;"></i>Your Message
              </label>
              <textarea class="form-control inquiry-input" id="inquiryMessage" name="message" rows="5" placeholder="Tell us about your inquiry or questions..." required></textarea>
            </div>
            
            <div class="text-center">
              <button type="submit" class="btn inquiry-submit-btn" style="background: linear-gradient(135deg, #7ab4a1 0%, #5a9a8a 100%); color: #fff; border: none; padding: 12px 40px; border-radius: 50px; font-weight: 600; font-size: 1.1rem; transition: all 0.3s ease;">
                <i class="fa fa-paper-plane me-2"></i>Send Inquiry
              </button>
            </div>
          </form>
          
          <div class="inquiry-info mt-4 pt-3" style="border-top: 1px solid rgba(122, 180, 161, 0.2);">
            <div class="row text-center">
              <div class="col-6">
                <div class="info-item">
                  <i class="fa fa-phone fa-2x mb-2" style="color: #7ab4a1;"></i>
                  <h6 style="color: #2c3e50; font-weight: 600; margin-bottom: 0.5rem;">Call Us</h6>
                  <small style="color: #6c757d;">0912 345 6789</small>
                </div>
              </div>
              <div class="col-6">
                <div class="info-item">
                  <i class="fa fa-clock-o fa-2x mb-2" style="color: #7ab4a1;"></i>
                  <h6 style="color: #2c3e50; font-weight: 600; margin-bottom: 0.5rem;">Response Time</h6>
                  <small style="color: #6c757d;">Within 24 hours</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<?php include 'footer.php'; ?>

    <!-- Auth Modals (login & register) -->
    <?php include 'Login/modal_login_niceadmin.php'; ?>
    <?php include 'Login/register-modal-paginated.php'; ?>

	<!-- Public Resort Map Modal (Interactive SVG with pins) -->
	<div class="modal fade" id="resortMapModal" tabindex="-1" aria-labelledby="resortMapLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-xl resort-map-dialog">
			<div class="modal-content">
				<div class="modal-header map-header">
					<h5 class="modal-title" id="resortMapLabel">Resort Map</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="d-flex flex-wrap align-items-center gap-2 mb-2 resort-map-toolbar">
						<div class="small text-muted me-2"><i class="fa fa-info-circle"></i> Toggle base 1/2, drag to pan, scroll to zoom, click pins for details.</div>
						<div class="input-group input-group-sm" style="max-width:280px;">
							<span class="input-group-text"><i class="fa fa-search"></i></span>
							<input id="pubMapSearch" type="text" class="form-control" placeholder="Search facilities...">
						</div>
						<div class="d-flex align-items-end gap-2 flex-wrap">
							<div class="d-flex flex-column">
								<label class="form-label mb-0 small">Start</label>
								<input id="pub_flt_start" type="datetime-local" class="form-control form-control-sm" />
							</div>
							<div class="d-flex flex-column">
								<label class="form-label mb-0 small">End</label>
								<input id="pub_flt_end" type="datetime-local" class="form-control form-control-sm" />
							</div>
							<div class="form-check form-switch ms-1">
								<input class="form-check-input" type="checkbox" role="switch" id="pub_flt_avail_only" disabled>
								<label class="form-check-label small" for="pub_flt_avail_only">Available only</label>
							</div>
							<button type="button" id="pub_btnResetAvail" class="btn btn-outline-secondary btn-sm"><i class="fa fa-undo"></i> Reset</button>
						</div>
						<div class="ms-auto d-flex align-items-center gap-2 flex-wrap">
							<div class="btn-group btn-group-sm" role="group" aria-label="Base map switch">
								<button type="button" class="btn btn-outline-secondary active" id="pubBtnMap1" aria-pressed="true">1</button>
								<button type="button" class="btn btn-outline-secondary" id="pubBtnMap2" aria-pressed="false">2</button>
							</div>
							<div class="btn-group btn-group-sm" role="group" aria-label="Zoom controls">
								<button type="button" class="btn btn-outline-secondary" id="pubZoomOut" title="Zoom Out"><i class="fa fa-minus"></i></button>
								<button type="button" class="btn btn-outline-secondary" id="pubZoomReset" title="Reset View"><i class="fa fa-compress"></i></button>
								<button type="button" class="btn btn-outline-secondary" id="pubZoomIn" title="Zoom In"><i class="fa fa-plus"></i></button>
							</div>
							<button type="button" class="btn btn-outline-secondary btn-sm" id="pubFullScreen" title="Fullscreen"><i class="fa fa-arrows-alt"></i></button>
						</div>
					</div>
					<div id="pubRangeSummary" class="text-muted small ms-1 mt-1"></div>
					<div class="svg-container" id="pubSvgContainer" style="width:100%;margin:0;border:none;background:transparent;overflow:visible;-webkit-overflow-scrolling:touch">
						<svg id="public-facility-map" viewBox="0 0 1200 600" preserveAspectRatio="xMidYMid meet" style="width:100%;height:100%;min-height:clamp(360px,60vh,640px);display:block;touch-action:pan-x pan-y pinch-zoom">
							<defs>
								<filter id="pinGlowGreen" x="-90%" y="-90%" width="280%" height="280%">
									<feDropShadow dx="0" dy="0" stdDeviation="10" flood-color="#28a745" flood-opacity="1" />
								</filter>
								<filter id="pinGlowRed" x="-90%" y="-90%" width="280%" height="280%">
									<feDropShadow dx="0" dy="0" stdDeviation="10" flood-color="#dc3545" flood-opacity="1" />
								</filter>
							</defs>
							<g id="pubMapLayer" transform="translate(0,0) scale(1)">
								<image id="pubMapImage" href="pics/1.svg" width="1200" height="600" />
							</g>
						</svg>
					</div>
					<div class="d-flex align-items-center gap-2 mt-2 small text-muted flex-wrap map-legend">
						<span><span class="legend-dot" style="background:#28a745"></span> Available</span>
						<span><span class="legend-dot" style="background:gray"></span> Unknown</span>
						<span><span class="legend-dot" style="background:#dc3545"></span> Unavailable</span>
					</div>
					<div id="public-facility-tooltip" class="card public-tooltip-card shadow" style="position:fixed; display:none; z-index:1051; pointer-events:none;">
						<div class="card-body p-2">
							<div class="fw-semibold" id="pubTipName"></div>
							<div class="small" id="pubTipStatus"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<style>
		/* Resort map modal sizing */
		.resort-map-dialog{max-width:60%}
		@media (max-width: 992px){ .resort-map-dialog{max-width:92%} }
		/* Themed headers */
		.map-header{background:linear-gradient(135deg, #7ab4a1, #5a9a8a); color:#fff}
		.map-header .modal-title{color:#fff;font-weight:600}
		.map-header .btn-close{filter:invert(1) grayscale(1) brightness(200%)}
		/* Themed toolbar */
		.resort-map-toolbar{background:linear-gradient(135deg, rgba(122,180,161,.12), rgba(224,143,95,.12)); border:1px solid rgba(122,180,161,.25); border-radius:12px; padding:8px 10px}
		.resort-map-toolbar .input-group-text{background:#fff;border-color:rgba(122,180,161,.35)}
		.resort-map-toolbar .form-control{border-color:rgba(122,180,161,.35)}
		.resort-map-toolbar .btn{border-color:rgba(122,180,161,.35)}
		.resort-map-toolbar .btn.active{background:var(--sbh-primary,#7ab4a1);color:#fff;border-color:var(--sbh-primary,#7ab4a1)}
		.resort-map-toolbar .btn:hover{background:rgba(122,180,161,.15)}
		.map-legend{color:#2c3e50;background:#fff;border:1px solid rgba(122,180,161,.2);border-radius:10px;padding:6px 10px}
		#public-facility-tooltip.public-tooltip-card{border:1px solid rgba(122,180,161,.3);border-radius:12px;background:#fff;margin:0;will-change: left, top, transform}
		#public-facility-tooltip .fw-semibold{color:#2c3e50;font-weight:600}
		#public-facility-tooltip .status-chip{background:linear-gradient(135deg,#7ab4a1,#5a9a8a);color:#fff;border-radius:9999px;padding:2px 8px;font-size:.8rem}
		/* Tighter spacing between name (e.g., t1) and status (Available) */
		#public-facility-tooltip .card-body{padding:4px 6px 4px 2px !important; display:block}
		#public-facility-tooltip #pubTipName{display:inline-flex; align-items:center; gap:2px; margin:0 !important; line-height:1.1; white-space:nowrap}
		#public-facility-tooltip .small{display:none !important}
		#public-facility-tooltip .status-chip{padding:1px 6px; font-size:.75rem; margin-left:2px; display:inline-block; vertical-align:middle}
		.facility-modal-divider{height:2px;background:linear-gradient(90deg,#7ab4a1,#e08f5f);opacity:.35;border-radius:2px}
		.legend-dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px;vertical-align:middle}
		.facility-pin{filter: drop-shadow(0 2px 2px rgba(0,0,0,.25));}
		.facility-pin image{transition:transform .18s ease; transform-box:fill-box; transform-origin:50% 100%;}
		.facility-pin:hover image,.facility-pin.pin-hover image{transform:translateY(-10px) scale(1.25);}
		.facility-pin.highlight{animation: pinPulse 1.4s ease-out 2; transform-origin:center}
		@keyframes pinPulse{0%{transform:scale(1)}50%{transform:scale(1.5)}100%{transform:scale(1)}}
		/* Themed auth buttons */
		.btn-theme-primary{background:linear-gradient(135deg,#7ab4a1,#5a9a8a);color:#fff;border:none;border-radius:9999px;padding:10px 18px;font-weight:600;box-shadow:0 6px 16px rgba(90,154,138,.25);transition:transform .15s ease, box-shadow .15s ease}
		.btn-theme-primary:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(90,154,138,.28);color:#fff}
		.btn-theme-accent{background:linear-gradient(135deg,#e08f5f,#e19985);color:#fff;border:none;border-radius:9999px;padding:10px 18px;font-weight:600;box-shadow:0 6px 16px rgba(224,143,95,.25);transition:transform .15s ease, box-shadow .15s ease}
		.btn-theme-accent:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(224,143,95,.28);color:#fff}
		.facility-modal-themed{border:1px solid rgba(122,180,161,.25); border-radius:14px; overflow:hidden}
		.facility-modal-dialog{max-width:520px}

		/* Mobile responsiveness for map modal */
		@media (max-width: 768px){
			#resortMapModal .modal-dialog{max-width:96% !important;margin:10px auto;}
			#public-facility-map{min-height:clamp(260px,65vh,520px) !important;}
			#public-facility-tooltip{display:none !important;}
			.pub-thumbs img{width:52px !important;height:52px !important}
			#publicFacilityBody .btn-theme-primary,#publicFacilityBody .btn-theme-accent{width:100%}
			/* Toolbar stacks and stretches on mobile */
			.resort-map-toolbar{flex-direction:column; align-items:stretch;}
			.resort-map-toolbar .input-group{max-width:100% !important}
			.resort-map-toolbar .ms-auto{margin-left:0 !important; width:100%; display:flex; justify-content:space-between}
			.resort-map-toolbar .d-flex.align-items-end.gap-2.flex-wrap{width:100%}
			#pubRangeSummary{margin-left:0 !important}
		}
		/* Desktop map container polish */
		#pubSvgContainer{border:1px solid rgba(122,180,161,.25); border-radius:12px; background:#fff}
		.resort-map-toolbar{margin-bottom:6px}
		#pubRangeSummary{margin:4px 0 6px 2px}
	</style>

	<!-- Public Facility Details Modal -->
	<div class="modal fade" id="publicFacilityModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered facility-modal-dialog">
			<div class="modal-content facility-modal-themed">
				<div class="modal-header map-header">
					<h5 class="modal-title">Facility Details</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body" id="publicFacilityBody"></div>
			</div>
		</div>
	</div>


    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    
    
    <script src="js/aos.js"></script>
    
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/bootstrap-datepicker.js"></script> 
    <script src="js/jquery.timepicker.min.js"></script> 

    

    <script src="js/main.js"></script>
    
    <!-- Auth & Navbar scripts loaded once on homepage to ensure modals work -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="js/notify.js?v=<?php echo filemtime('js/notify.js'); ?>"></script>
    <script src="js/navbar-enhanced.js"></script>
    <script src="js/login-modal-fixed.js"></script>
    <script src="js/register-modal-otp-fixed.js?v=<?php echo filemtime('js/register-modal-otp-fixed.js'); ?>"></script>
    <script>
    (function(){
      const IS_LOGGED_IN = <?php echo isset($isLoggedIn) && $isLoggedIn ? 'true' : 'false'; ?>;
      const modalEl = document.getElementById('resortMapModal');
      if (!modalEl) return;
      let facilities = [];
      let svg, layer, tooltip, tipName, tipStatus, mapImg;
      let isPanning = false, startX = 0, startY = 0, translateX = 0, translateY = 0, scale = 1;
      const MIN_SCALE = 0.8, MAX_SCALE = 3.0, ZOOM_STEP = 0.15;
      function renderPins(){
        if (!layer) return;
        Array.from(layer.querySelectorAll('.facility-pin')).forEach(n=>n.remove());
        const ICON_AVAIL = 'pics/marker-available.svg';
        const ICON_UNAVAIL = 'pics/marker-unavailable.svg';
        const PIN_W = 24, PIN_H = 28;
        const PIN_SCALE_MOBILE = 3.8;
        const PIN_SCALE_DESKTOP = 4.2;
        const scale = (window.innerWidth < 576 ? PIN_SCALE_MOBILE : PIN_SCALE_DESKTOP);
        facilities.forEach(f=>{
          const status = String(f.status||'').toLowerCase();
          const href = (status === 'available') ? ICON_AVAIL : ICON_UNAVAIL;
          const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
          g.classList.add('facility-pin');
          g.setAttribute('transform', `translate(${f.pin_x}, ${f.pin_y})`);
          const title = document.createElementNS('http://www.w3.org/2000/svg', 'title');
          title.textContent = `${f.name||''} — ${status||'unknown'}`;
          g.appendChild(title);
          const img = document.createElementNS('http://www.w3.org/2000/svg', 'image');
          img.setAttribute('href', href);
          img.setAttribute('x', String(-(PIN_W/2) * scale));
          img.setAttribute('y', String(-PIN_H * scale));
          img.setAttribute('width', String(PIN_W * scale));
          img.setAttribute('height', String(PIN_H * scale));
          img.setAttribute('filter', href===ICON_AVAIL ? 'url(#pinGlowGreen)' : 'url(#pinGlowRed)');
          g.appendChild(img);
          // match tap/hover animation behavior from booking pages
          try{
            g.addEventListener('pointerdown', function(){ g.classList.add('pin-hover'); setTimeout(()=> g.classList.remove('pin-hover'), 220); });
            g.addEventListener('touchstart', function(){ g.classList.add('pin-hover'); setTimeout(()=> g.classList.remove('pin-hover'), 220); }, { passive:true });
          }catch(e){}
          g.addEventListener('mouseenter', (e)=> showTip(e, f));
          g.addEventListener('mousemove', (e)=> moveTip(e));
          g.addEventListener('mouseleave', hideTip);
          g.addEventListener('click', ()=> openPublicFacilityModal(f));
          layer.appendChild(g);
        });
      }

      async function colorPinsForRange(startVal, endVal){
        if (!startVal || !endVal) { renderPins(); return; }
        try {
          // mark pins with availability info
          const tasks = facilities.map(async (f)=>{
            try{
              const params = new URLSearchParams({ facility_name: f.name, date_start: startVal, date_end: endVal });
              const r = await fetch('customerdash/check_availability.php?' + params.toString(), { credentials:'same-origin' });
              const j = await r.json();
              f.__rangeAvailable = !!(j && j.success && j.available);
              f.__amountForRange = Number(j && j.amount ? j.amount : 0);
            }catch(e){ f.__rangeAvailable = null; f.__amountForRange = 0; }
          });
          await Promise.all(tasks);
        } catch(e) {}
        // re-render pins with availability coloring
        if (!layer) return;
        Array.from(layer.querySelectorAll('.facility-pin')).forEach(n=>n.remove());
        const ICON_AVAIL = 'pics/marker-available.svg';
        const ICON_UNAVAIL = 'pics/marker-unavailable.svg';
        const PIN_W = 24, PIN_H = 28;
        const PIN_SCALE_MOBILE = 3.8;
        const PIN_SCALE_DESKTOP = 4.2;
        const onlyAvail = !!(document.getElementById('pub_flt_avail_only')?.checked);
        const scale = (window.innerWidth < 576 ? PIN_SCALE_MOBILE : PIN_SCALE_DESKTOP);
        facilities.forEach(f=>{
          const isAvail = (f.__rangeAvailable === true);
          if (onlyAvail && !isAvail) return;
          const href = isAvail ? ICON_AVAIL : ICON_UNAVAIL;
          const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
          g.classList.add('facility-pin');
          g.setAttribute('transform', `translate(${f.pin_x}, ${f.pin_y})`);
          const title = document.createElementNS('http://www.w3.org/2000/svg', 'title');
          title.textContent = `${f.name||''} — ${isAvail?'available':'unavailable'}`;
          g.appendChild(title);
          const img = document.createElementNS('http://www.w3.org/2000/svg', 'image');
          img.setAttribute('href', href);
          img.setAttribute('x', String(-(PIN_W/2) * scale));
          img.setAttribute('y', String(-PIN_H * scale));
          img.setAttribute('width', String(PIN_W * scale));
          img.setAttribute('height', String(PIN_H * scale));
          img.setAttribute('filter', href===ICON_AVAIL ? 'url(#pinGlowGreen)' : 'url(#pinGlowRed)');
          g.appendChild(img);
          try{
            g.addEventListener('pointerdown', function(){ g.classList.add('pin-hover'); setTimeout(()=> g.classList.remove('pin-hover'), 220); });
            g.addEventListener('touchstart', function(){ g.classList.add('pin-hover'); setTimeout(()=> g.classList.remove('pin-hover'), 220); }, { passive:true });
          }catch(e){}
          g.addEventListener('mouseenter', (e)=> showTip(e, f));
          g.addEventListener('mousemove', (e)=> moveTip(e));
          g.addEventListener('mouseleave', hideTip);
          g.addEventListener('click', ()=> openPublicFacilityModal(f));
          layer.appendChild(g);
        });
        // update summary
        try{
          const tot = facilities.length;
          const yes = facilities.filter(x=> x.__rangeAvailable===true).length;
          const no  = facilities.filter(x=> x.__rangeAvailable===false).length;
          const un  = tot - yes - no;
          const sumEl = document.getElementById('pubRangeSummary');
          if (sumEl) sumEl.innerHTML = `In range: <strong>${yes}</strong> available, <strong>${no}</strong> unavailable, <strong>${un}</strong> unknown`;
        }catch(e){}
      }
      function showTip(evt, f){
        if (!tooltip) return;
        const name = String(f.name||'').trim();
        const status = String(f.status||'').trim();
        // Render everything into a single inline block to eliminate internal gaps
        const html = `<span style="display:inline-flex;align-items:center;gap:2px;white-space:nowrap"><strong>${name}</strong><span class=\"status-chip\">${status}</span></span>`;
        tipName.innerHTML = html;
        tipStatus.innerHTML = '';
        tooltip.style.display = 'block';
        requestAnimationFrame(()=> moveTip(evt));
      }
      function moveTip(evt){
        if (!tooltip) return;
        const margin = 8;
        // Place tooltip origin exactly at cursor and shift via translate
        const x = (evt.clientX ?? (evt.touches && evt.touches[0] && evt.touches[0].clientX) ?? 0);
        const y = (evt.clientY ?? (evt.touches && evt.touches[0] && evt.touches[0].clientY) ?? 0);
        tooltip.style.left = x + 'px';
        tooltip.style.top  = y + 'px';
        // Default: directly beside the cursor on the right with slight negative gap (hug cursor)
        tooltip.style.transform = 'translate(-2px, -50%)';

        const rect = tooltip.getBoundingClientRect();
        const vw = window.innerWidth || document.documentElement.clientWidth;
        const vh = window.innerHeight || document.documentElement.clientHeight;

        // Keep within viewport vertically by nudging top if necessary
        let top = y;
        if (rect.top < margin) {
          top = margin + rect.height / 2;
          tooltip.style.top = Math.round(top) + 'px';
        } else if (rect.bottom > vh - margin) {
          top = vh - margin - rect.height / 2;
          tooltip.style.top = Math.round(top) + 'px';
        }

        // If clipped on the right, flip to left of cursor
        if (rect.right > vw - margin) {
          // Flip to left of cursor with tiny negative gap
          tooltip.style.transform = 'translate(-98%, -50%)';
        }
      }
      function hideTip(){ if (tooltip) tooltip.style.display='none'; }
      function switchBase(src){ if (mapImg) { mapImg.setAttribute('href', src); renderPins(); } }
      function applyTransform(){ if (layer) { layer.setAttribute('transform', `translate(${translateX},${translateY}) scale(${scale})`); } }
      function zoom(delta, centerX = 600, centerY = 300){
        const newScale = Math.min(MAX_SCALE, Math.max(MIN_SCALE, scale + delta));
        if (!svg || !layer) { scale = newScale; applyTransform(); return; }
        // Adjust translate to zoom around a point in SVG coords
        const k = newScale / scale;
        translateX = centerX - k*(centerX - translateX);
        translateY = centerY - k*(centerY - translateY);
        scale = newScale;
        applyTransform();
      }
      modalEl.addEventListener('shown.bs.modal', function(){
        svg = document.getElementById('public-facility-map');
        layer = document.getElementById('pubMapLayer');
        tooltip = document.getElementById('public-facility-tooltip');
        tipName = document.getElementById('pubTipName');
        tipStatus = document.getElementById('pubTipStatus');
        mapImg = document.getElementById('pubMapImage');
        // reset view
        translateX = 0; translateY = 0; scale = 1; applyTransform();
        // fetch public facilities
        fetch('customerdash/retrieve_facility.php', { cache: 'no-store' }).then(r=>r.json()).then(list=>{
          facilities = Array.isArray(list)? list : [];
          renderPins();
        }).catch(()=>{ facilities = []; renderPins(); });
        // initialize date filter min values and handlers
        try{
          const fs = document.getElementById('pub_flt_start');
          const fe = document.getElementById('pub_flt_end');
          const only = document.getElementById('pub_flt_avail_only');
          const toLocal = (d)=>{ const tzOff = d.getTimezoneOffset(); const local = new Date(d.getTime() - tzOff*60*1000); return local.toISOString().slice(0,16); };
          const setMins = ()=>{
            const nowLocal = toLocal(new Date());
            if (fs) { fs.min = nowLocal; if (fs.value && fs.value < nowLocal) fs.value = nowLocal; }
            if (fe) { fe.min = (fs && fs.value) ? fs.value : nowLocal; if (fe.value && fs && fs.value && fe.value < fs.value) fe.value = fs.value; }
            const s = fs?.value || ''; const e = fe?.value || '';
            if (only) only.disabled = !(s && e);
            if (s && e) colorPinsForRange(s, e); else renderPins();
          };
          fs?.addEventListener('input', setMins);
          fe?.addEventListener('input', setMins);
          only?.addEventListener('change', ()=>{ const s = fs?.value||''; const e = fe?.value||''; if (s && e) colorPinsForRange(s,e); });
          document.getElementById('pub_btnResetAvail')?.addEventListener('click', ()=>{ try{ fs.value=''; fe.value=''; if (only){ only.checked=false; only.disabled=true; } document.getElementById('pubRangeSummary').textContent=''; }catch(e){} renderPins(); });
          setMins();
        }catch(e){}
        // Attach pan/zoom handlers
        const container = document.getElementById('pubSvgContainer');
        if (container) {
          container.addEventListener('wheel', function(e){
            if (!svg) return;
            e.preventDefault();
            // Convert mouse to SVG coords (assuming viewBox 0 0 1200 600)
            const rect = container.getBoundingClientRect();
            const sx = ((e.clientX - rect.left) / rect.width) * 1200;
            const sy = ((e.clientY - rect.top) / rect.height) * 600;
            zoom(e.deltaY < 0 ? ZOOM_STEP : -ZOOM_STEP, sx, sy);
          }, { passive:false });
          container.addEventListener('mousedown', function(e){ isPanning = true; startX = e.clientX; startY = e.clientY; });
          window.addEventListener('mousemove', function(e){ if (!isPanning) return; translateX += (e.clientX - startX) * (1200 / (container.clientWidth * scale)); translateY += (e.clientY - startY) * (600 / (container.clientHeight * scale)); startX = e.clientX; startY = e.clientY; applyTransform(); });
          window.addEventListener('mouseup', function(){ isPanning = false; });
        }
        // Controls
        document.getElementById('pubZoomIn')?.addEventListener('click', ()=> zoom(ZOOM_STEP));
        document.getElementById('pubZoomOut')?.addEventListener('click', ()=> zoom(-ZOOM_STEP));
        document.getElementById('pubZoomReset')?.addEventListener('click', ()=> { translateX = 0; translateY = 0; scale = 1; applyTransform(); });
        document.getElementById('pubFullScreen')?.addEventListener('click', ()=>{
          const el = document.getElementById('pubSvgContainer');
          if (!document.fullscreenElement) { el?.requestFullscreen?.(); } else { document.exitFullscreen?.(); }
        });
        // Search
        const search = document.getElementById('pubMapSearch');
        if (search) {
          search.addEventListener('input', function(){
            const q = String(this.value||'').toLowerCase().trim();
            Array.from(layer?.querySelectorAll('.facility-pin')||[]).forEach(pin=> pin.classList.remove('highlight'));
            if (!q) return;
            const idx = facilities.findIndex(f=> String(f.name||'').toLowerCase().includes(q));
            if (idx >= 0) {
              const f = facilities[idx];
              const pin = Array.from(layer.querySelectorAll('.facility-pin'))[idx];
              if (pin) { pin.classList.add('highlight'); }
              // center on pin
              const cx = Number(f.pin_x)||600; const cy = Number(f.pin_y)||300;
              translateX = (1200/2 - cx*scale);
              translateY = (600/2 - cy*scale);
              applyTransform();
            }
          });
        }
      });
      document.getElementById('pubBtnMap1')?.addEventListener('click', function(){ this.classList.add('active'); document.getElementById('pubBtnMap2')?.classList.remove('active'); switchBase('pics/1.svg'); });
      document.getElementById('pubBtnMap2')?.addEventListener('click', function(){ this.classList.add('active'); document.getElementById('pubBtnMap1')?.classList.remove('active'); switchBase('pics/2.svg'); });
      modalEl.addEventListener('hide.bs.modal', function(){ if (tooltip) tooltip.style.display='none'; });

      function normalizeImagePath(p){
        if (!p) return '';
        let s = String(p);
        if (s.startsWith('http') || s.startsWith('/')) return s;
        if (s.startsWith('admindash/')) return s; // already relative to site root
        if (s.startsWith('admindash2/')) return s; // legacy
        return s;
      }
      function openPublicFacilityModal(f){
        // Ensure any floating tooltip is hidden before showing modal
        hideTip();
        const raw = f.image || '';
        const images = String(raw).includes(',') ? String(raw).split(',').map(s=>normalizeImagePath(s.trim())).filter(Boolean) : [normalizeImagePath(raw)].filter(Boolean);
        const mainImg = images[0] || '';
        const body = document.getElementById('publicFacilityBody');
        const imageHtml = images.length ? `
          <div class=\"text-center mb-3\">
            <img id=\"pubMainImg\" src=\"${mainImg}\" alt=\"${(f.name||'').replace(/&/g,'&amp;').replace(/</g,'&lt;')}\" class=\"img-fluid rounded\" style=\"max-height:360px; object-fit:cover;\" onerror=\"this.style.display='none'\">
          </div>
          <div class=\"d-flex flex-wrap gap-2 justify-content-center mb-3 pub-thumbs\">${images.map((src,i)=>`
            <img src=\"${src}\" data-idx=\"${i}\" class=\"pub-thumb-img${i===0?' active':''}\" style=\"width:64px;height:64px;object-fit:cover;border-radius:8px;border:2px solid ${i===0?'#7ab4a1':'#eaeaea'};cursor:pointer\"/>
          `).join('')}</div>` : '<div class=\"text-muted\">No image available</div>';
        const statusBadge = `<span class="badge ${String(f.status||'').toLowerCase()==='available'?'bg-success':'bg-danger'}">${f.status||''}</span>`;
        const actionHtml = IS_LOGGED_IN ? '' : `
          <div class=\"mt-3 d-flex flex-wrap gap-2\">
            <button type=\"button\" class=\"btn btn-theme-primary\" onclick=\"openAuthFromMap('login')\">
              <i class=\"fa fa-sign-in me-1\"></i> Login to Reserve
            </button>
            <button type=\"button\" class=\"btn btn-theme-accent\" onclick=\"openAuthFromMap('register')\">
              <i class=\"fa fa-user-plus me-1\"></i> Create Account
            </button>
          </div>`;
        body.innerHTML = `
          ${imageHtml}
          <h4 class=\"mb-1\">${f.name||''}</h4>
          <div class=\"mb-2\">${statusBadge}</div>
          <p class=\"mb-2\"><strong>Price:</strong> ₱${(Number(f.price||0)).toLocaleString('en-PH')}</p>
          <p>${(f.details||'').replace(/&/g,'&amp;').replace(/</g,'&lt;')}</p>
          ${actionHtml}
        `;
        // Show details as a nested modal without its own backdrop
        const detailsEl = document.getElementById('publicFacilityModal');
        const detailsModal = bootstrap.Modal.getOrCreateInstance(detailsEl, { backdrop: false, focus: true });
        detailsModal.show();
        const main = document.getElementById('pubMainImg');
        document.querySelectorAll('.pub-thumb-img').forEach(img=>{
          img.addEventListener('click', function(){
            const src = this.getAttribute('src');
            if (main && src) { main.src = src; }
            document.querySelectorAll('.pub-thumb-img').forEach(t=>{ t.classList.remove('active'); t.style.borderColor = '#eaeaea'; });
            this.classList.add('active'); this.style.borderColor = '#7ab4a1';
          });
        });
        if (main) { main.addEventListener('error', function(){ try { main.parentElement.style.display = 'none'; } catch(e){} }); }
      }
      window.openAuthFromMap = function(mode){
        hideTip();
        // Hide any Bootstrap modals first
        try{ const fm = bootstrap.Modal.getOrCreateInstance(document.getElementById('publicFacilityModal')); if (fm) fm.hide(); }catch(e){}
        try{ const mm = bootstrap.Modal.getOrCreateInstance(document.getElementById('resortMapModal')); if (mm) mm.hide(); }catch(e){}
        // Clean up leftover backdrops and modal-open class to allow typing
        setTimeout(function(){
          try {
            document.querySelectorAll('.modal-backdrop').forEach(el=> el.remove());
            document.body.classList.remove('modal-open');
            document.body.style.removeProperty('padding-right');
          } catch(e){}
          // Open the appropriate auth overlay
          if (mode === 'register') {
            (window.openRegisterModal||function(){})();
          } else {
            (window.openLoginModal||window.openSignInModal||function(){})();
          }
          // Ensure auth overlay is on top and focusable
          setTimeout(function(){
            var overlay = document.getElementById('loginModalOverlay');
            if (overlay) { overlay.style.zIndex = '2000'; overlay.style.pointerEvents = 'auto'; }
            var email = document.getElementById('loginEmail');
            if (email) { try { email.focus(); } catch(e){} }
          }, 150);
        }, 200);
      }
    })();
    </script>
    
    <!-- Back to Top Button -->
    <button class="back-to-top" onclick="scrollToTop()">↑</button>
    
    <script>
    function scrollToTop() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    }
    
    // Show/hide back to top button based on scroll position
    window.addEventListener('scroll', function() {
        const backToTopBtn = document.querySelector('.back-to-top');
        if (window.pageYOffset > 300) {
            backToTopBtn.style.display = 'block';
        } else {
            backToTopBtn.style.display = 'none';
        }
    });
    
    // Inquiry Form Handling
    document.addEventListener('DOMContentLoaded', function() {
        const inquiryForm = document.getElementById('inquiryForm');
        const submitBtn = document.querySelector('.inquiry-submit-btn');
        
        if (inquiryForm) {
            inquiryForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form data
                const formData = new FormData(this);
                const name = formData.get('name');
                const email = formData.get('email');
                const message = formData.get('message');
                
                // Basic validation
                if (!name || !email || !message) {
                    showInquiryMessage('Please fill in all fields.', 'error');
                    return;
                }
                
                if (!isValidEmail(email)) {
                    showInquiryMessage('Please enter a valid email address.', 'error');
                    return;
                }
                
                // Show loading state
                submitBtn.classList.add('loading');
                submitBtn.disabled = true;
                
                // Submit to backend
                fetch('inquiries/submit.php', {
                    method: 'POST',
                    body: formData
                })
                .then(res => res.json())
                .then(data => {
                    submitBtn.classList.remove('loading');
                    submitBtn.disabled = false;
                    if (data.success) {
                        showInquiryMessage(data.message || 'Thank you! Your inquiry has been sent successfully. We\'ll get back to you within 24 hours.', 'success');
                        inquiryForm.reset();
                        setTimeout(() => { const successMsg = document.querySelector('.inquiry-success'); if (successMsg) successMsg.remove(); }, 5000);
                    } else {
                        showInquiryMessage(data.message || 'Failed to send your inquiry. Please try again.', 'error');
                    }
                })
                .catch(err => {
                    submitBtn.classList.remove('loading');
                    submitBtn.disabled = false;
                    showInquiryMessage('Server error. Please try again later.', 'error');
                });
            });
            
            // Real-time validation feedback
            const inputs = inquiryForm.querySelectorAll('.inquiry-input');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    validateField(this);
                });
                
                input.addEventListener('input', function() {
                    if (this.classList.contains('is-invalid')) {
                        this.classList.remove('is-invalid');
                    }
                });
            });
        }
    });
    
    // Email validation function
    function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }
    
    // Field validation function
    function validateField(field) {
        const value = field.value.trim();
        const fieldName = field.name;
        
        if (!value) {
            field.classList.add('is-invalid');
            return false;
        }
        
        if (fieldName === 'email' && !isValidEmail(value)) {
            field.classList.add('is-invalid');
            return false;
        }
        
        field.classList.remove('is-invalid');
        return true;
    }
    
    // Show inquiry message function
    function showInquiryMessage(message, type) {
        // Remove existing messages
        const existingMsg = document.querySelector('.inquiry-success, .inquiry-error');
        if (existingMsg) {
            existingMsg.remove();
        }
        
        // Create message element
        const messageDiv = document.createElement('div');
        messageDiv.className = type === 'success' ? 'inquiry-success' : 'inquiry-error';
        
        const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
        messageDiv.innerHTML = `
            <i class="fa ${icon}"></i>
            <p class="mb-0">${message}</p>
        `;
        
        // Insert message after the form
        const form = document.getElementById('inquiryForm');
        form.parentNode.insertBefore(messageDiv, form.nextSibling);
        
        // Scroll to message
        messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    // Star Rating Filter Functionality
    document.addEventListener('DOMContentLoaded', function() {
        const filterBtns = document.querySelectorAll('.filter-btn');
        const feedbackCards = document.querySelectorAll('[data-rating]');
        let activeFilters = new Set();
        
        filterBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const rating = this.getAttribute('data-rating');
                
                if (rating === 'all') {
                    // Reset all filters
                    activeFilters.clear();
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show all cards
                    feedbackCards.forEach(card => {
                        card.style.display = 'block';
                        card.style.animation = 'fadeInUp 0.6s ease forwards';
                    });
                } else {
                    // Toggle individual star rating filters
                    if (activeFilters.has(rating)) {
                        // Remove this filter
                        activeFilters.delete(rating);
                        this.classList.remove('active');
                    } else {
                        // Add this filter
                        activeFilters.add(rating);
                        this.classList.add('active');
                    }
                    
                    // Apply filters
                    if (activeFilters.size === 0) {
                        // No filters active, show all
                        feedbackCards.forEach(card => {
                            card.style.display = 'block';
                            card.style.animation = 'fadeInUp 0.6s ease forwards';
                        });
                    } else {
                        // Show only cards matching active filters
                        feedbackCards.forEach(card => {
                            const cardRating = card.getAttribute('data-rating');
                            if (activeFilters.has(cardRating)) {
                                card.style.display = 'block';
                                card.style.animation = 'fadeInUp 0.6s ease forwards';
                            } else {
                                card.style.display = 'none';
                            }
                        });
                    }
                }
            });
        });
    });
    </script>
  </body>
</html>
